---
layout: article
title: struct in swift
tags: ['iOS','swift']
---

## immutable struct

struct å’Œ class ç±»ä¼¼ï¼Œä½†æ˜¯ç”±äº class æ”¯æŒç»§æ‰¿ç­‰ç‰¹æ€§ï¼Œæ‰€ä»¥åœ¨ OOP ç¼–ç¨‹ä¸­ï¼Œæ›´ç»å¸¸ä½¿ç”¨ classï¼Œå¾€å¾€å¿½ç•¥äº† structã€‚ä½†åœ¨ iOS å¼•å…¥ swiftUI ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤š struct çš„å½±å­ï¼Œæœ‰å¿…è¦æ¥å…³æ³¨ä¸‹ struct çš„ç‰¹æ€§ï¼Œé¿å…åœ¨æ‰å…¥ä¸€äº›é™·é˜±ä¸­ã€‚

```swift
struct Student {
    var age: Int
}

var s = Student(age: 12)
s.age = 13
print(s.age)  //13
```
ä¸Šé¢æ˜¯ä¸€æ®µå¹³å¹³æ— å¥‡çš„ struct ä»£ç ï¼Œä½ ç”šè‡³ä¸ä¼šæƒ³åœ¨ Xcode ä¸­è¿è¡Œå®ƒã€‚ç°åœ¨æˆ‘ä»¬ä¸º `s` æ·»åŠ ä¸€ä¸ª `didSet` çš„å±æ€§è§‚å¯Ÿå™¨ã€‚

```swift
struct Student {
    var age: Int
}

var s = Student(age: 12) {
    didSet {
        print("s changed : \(t)")
    }
}
s.age = 13
print(s.age)  //13
```
å†æ¬¡è¿è¡Œä¼šå‘ç° `didSet` ä¸­çš„ä»£ç è¢«æ‰§è¡Œäº†ï¼Œè¿™æ„å‘³ç€ `s` è¢«æ”¹å˜äº†ï¼ `s` è¢«æ”¹å˜çš„åŸå› åœ¨äºï¼š**struct æ˜¯å€¼ç±»å‹ï¼Œå€¼ç±»å‹æ„å‘³ç€ä¸å¯æ”¹å˜**ã€‚ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯¹ `age` è¿›è¡Œäº†ä¿®æ”¹ï¼Œä¼šå¯¼è‡´æ–°åˆ›å»ºä¸€ä¸ª `age = 13` çš„ç»“æ„ä½“ï¼Œç„¶åå°†æ–°ç»“æ„ä½“é‡æ–°èµ‹å€¼ç»™ `s`ï¼Œæ‰€ä»¥è¡¨é¢ä¸Šçœ‹èµ·æ¥ `s` è¿˜æ˜¯é‚£ä¸ª `s`ï¼Œä½†å®é™…ä¸Šå·²ç»ç‰©æ˜¯äººéäº†ã€‚

ğŸ‘†ç¤ºä¾‹ä»£ç æ€»ç»“å‡ºæ¥ï¼š**struct æ˜¯å€¼ç±»å‹ï¼Œæ˜¯ä¸å¯æ”¹å˜çš„(immutable)ï¼Œæ”¹å˜å±æ€§çš„å€¼ä¼šæ–°åˆ›å»ºä¸€æ•´ä¸ªç»“æ„ä½“é‡æ–°èµ‹å€¼**ã€‚

ç”±äº struct æ˜¯å€¼ç±»å‹ï¼Œæ‰€ä»¥åœ¨ struct çš„æ–¹æ³•ä¸­æ˜¯æ— æ³•ä¿®æ”¹å±æ€§å€¼çš„ã€‚
```swift
struct Student {
    var age: Int

    func addAge() {
        self.age += 1  // Error!!ğŸ¥µ
    }
}
```
åœ¨ `addAge` ä¸­è¯•å›¾å¯¹ `age` è¿›è¡Œä¿®æ”¹ä¼šå¯¼è‡´ç¼–è¯‘å™¨æŠ¥é”™ï¼Œ**å¦‚æœä¸€å®šè¦åœ¨æ–¹æ³•ä¸­ä¿®æ”¹ struct çš„å±æ€§ï¼Œé‚£ä¹ˆæ–¹æ³•éœ€è¦ä½¿ç”¨  `mutating` ä¿®é¥°**

```swift

struct Student {
    var age: Int
    mutating func addAge() {
        self.age += 1  // OK Â ğŸ¥³
    }
}

var s = Student(age: 12) {
    didSet {
        print("s changed : \(t)")  // ä»ç„¶è¢«æ‰§è¡Œ
    }
}
s.addAge()
```
ä½¿ç”¨ `mutating` ä¿®é¥°ä¹‹åå¯ä»¥åœ¨æ–¹æ³•ä¸­ä¿®æ”¹å±æ€§å€¼ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šï¼Œè¿˜æ˜¯æ–°åˆ›å»ºäº†ä¸€ä¸ªç»“æ„ä½“å®ä¾‹æ›¿æ¢äº†åŸæœ¬çš„ `s`ã€‚

é‚£ä¹ˆè¿™ä¸ªç‰¹æ€§åœ¨ swiftUI ä¸­æœ‰ä½•ä½“ç°ï¼Ÿ

## `@State with struct`

ä¸‹é¢çš„ swiftUI ä»£ç è‚¯å®šå¾ˆç†Ÿæ‚‰

```swift
struct User {
    var name:String = ""
}

struct ContentView: View {
    
    @State var user = User()

    var body: some View {
        VStack{
            Text("hello \(user.name)")
            TextField("input your name", text: $user.name)
        }
    }
}
```
ä½¿ç”¨ `@State` ä¿®é¥°ä¹‹åï¼Œæ¯æ¬¡ `user` å˜åŒ–ï¼Œéƒ½ä¼šåŠæ—¶çš„é€šçŸ¥ UI æ›´æ–°æ•°æ®ã€‚`@State` æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ

æ³¨æ„åˆ°ï¼Œ`User` æ˜¯ä½¿ç”¨ struct å®šä¹‰çš„ï¼Œè€Œä¸æ˜¯ classï¼Œé‚£ä¹ˆå¦‚åŒä¸Šé¢æˆ‘ä»¬æåˆ°çš„ï¼Œæ¯æ¬¡ä¿®æ”¹ `user.name` çš„å€¼ï¼Œå…¶å®éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ `User` å®ä¾‹é‡æ–°èµ‹å€¼ç»™ `user` å˜é‡ï¼Œ`@State` è§‚å¯Ÿåˆ° `user` å˜åŒ–ï¼Œä¾¿é€šçŸ¥ UI è¿›è¡Œæ›´æ–°

å¦‚æœæŠŠ `User` ä» struct æ”¹æˆ classï¼Œä¼šå‘ç° UI ä¸ä¼šæ›´æ–°ï¼Œè¿™æ˜¯å› ä¸º class æ˜¯ã€Œå¼•ç”¨ç±»å‹ã€ï¼Œå±æ€§å€¼å˜åŒ–ä¸ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ `User class` èµ‹å€¼ç»™ `user` å˜é‡ï¼Œ`user` å˜é‡æ²¡æœ‰å˜åŒ–ï¼ŒUI ä¹Ÿæ— æ³•æ”¶åˆ°é€šçŸ¥ã€‚
